---
const base = Astro.site?.pathname ?? "/";
const href = (path = "") => `${base}${path}`.replace(/\/+/g, "/");
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>My Learning Tracker</title>

    <style is:global>
      :root {
        --bg: #0b0f19;
        --surface: #111827;
        --surface-elevated: #1f2937;

        --text: #e5e7eb;
        --muted-text: #9ca3af;

        --accent: #22d3ee;
        --accent-soft: rgba(34, 211, 238, 0.12);

        --border: #1f2937;
        --sidebar-width: 240px;
        --header-height: 64px;
      }

      html.light {
        --bg: #f9fafb;
        --surface: #ffffff;
        --surface-elevated: #f3f4f6;

        --text: #0b1220;
        --muted-text: #6b7280;

        --border: #e5e7eb;
      }

      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: Inter, system-ui, sans-serif;
        min-height: 100vh;
      }

      /* ================= Mobile Header ================= */
      .mobile-header {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: var(--header-height);
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        z-index: 100;
      }

      .brand-mobile {
        font-size: 20px;
        font-weight: 600;
      }

      /* Hamburger ‚Äì agora vira X corretamente */
      .hamburger {
        width: 30px;
        height: 30px;
        cursor: pointer;
        display: grid;
        place-items: center;
        position: relative;
      }

      .hamburger span {
        width: 24px;
        height: 2px;
        background: var(--text);
        border-radius: 2px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: absolute;
      }

      .hamburger span:nth-child(1) { top: 9px; }
      .hamburger span:nth-child(2) { top: 14px; }
      .hamburger span:nth-child(3) { top: 19px; }

      /* Estado ativo ‚Üí X */
      .hamburger.active span:nth-child(1) {
        transform: rotate(45deg);
        top: 14px;
      }

      .hamburger.active span:nth-child(2) {
        opacity: 0;
      }

      .hamburger.active span:nth-child(3) {
        transform: rotate(-45deg);
        top: 14px;
      }

      /* ================= Sidebar ================= */
      aside {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: var(--sidebar-width);
        background: var(--surface);
        border-right: 1px solid var(--border);
        padding: 32px 20px;
        display: flex;
        flex-direction: column;
        gap: 32px;
        z-index: 90;
        transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .brand {
        font-size: 18px;
        font-weight: 600;
      }

      nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      nav a {
        display: block;
        padding: 12px 16px;
        border-radius: 10px;
        text-decoration: none;
        color: var(--text);
        font-size: 15px;
        transition: all 0.2s ease;
      }

      nav a:hover {
        background: var(--accent-soft);
        color: var(--accent);
      }

      .sidebar-footer {
        margin-top: auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 13px;
        color: var(--muted-text);
      }

      /* ================= Main ================= */
      main {
        min-height: 100vh;
        padding: 40px 24px;
        transition: margin-left 0.35s ease;
      }

      .container {
        max-width: 1100px;
        margin: 0 auto;
      }

      article {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 32px;
      }

      /* ================= Theme Toggle ================= */
      .theme-toggle {
        display: flex;
        align-items: center;
        cursor: pointer;
      }

      .theme-toggle input {
        opacity: 0;
        position: absolute;
      }

      .toggle-track {
        width: 56px;
        height: 28px;
        background: #1b73ed;
        border-radius: 999px;
        padding: 4px;
        transition: background 0.4s ease;
        border: 1px solid var(--border);
      }

      .toggle-thumb {
        width: 24px;
        height: 24px;
        background: #87b0ea;
        border-radius: 50%;
        display: grid;
        place-items: center;
        transition: all 0.4s ease;
        font-size: 14px;
      }

      .toggle-thumb::before {
        content: "‚òÄÔ∏è";
      }

      .theme-toggle input:checked + .toggle-track {
        background: #063356;
      }

      .theme-toggle input:checked + .toggle-track .toggle-thumb {
        transform: translateX(28px);
        background: #012d56;
      }

      .theme-toggle input:checked + .toggle-track .toggle-thumb::before {
        content: "üåô";
      }

      /* ================= Responsive ================= */
      @media (max-width: 768px) {
        .mobile-header {
          display: flex;
        }

        /* Toggle no header mobile */
        .mobile-theme-toggle {
          display: flex;
        }

        /* Esconde toggle da sidebar em mobile */
        .sidebar-footer .theme-toggle {
          display: none;
        }

        aside {
          transform: translateX(-100%);
        }

        aside.open {
          transform: translateX(0);
        }

        main {
          padding-top: calc(var(--header-height) + 24px);
          margin-left: 0 !important;
        }

        article {
          padding: 24px;
        }
      }

      @media (min-width: 769px) {
        main {
          margin-left: var(--sidebar-width);
        }

        .mobile-header,
        .mobile-theme-toggle {
          display: none;
        }
      }
    </style>
  </head>

  <body>
    <!-- Mobile Header -->
    <header class="mobile-header">
      <div class="hamburger" id="hamburger" aria-label="Abrir menu">
        <span></span>
        <span></span>
        <span></span>
      </div>

      <div class="brand-mobile">My Learning</div>

      <!-- Theme toggle no canto direito (apenas mobile) -->
      <label class="theme-toggle mobile-theme-toggle">
        <input type="checkbox" id="theme-toggle" />
        <div class="toggle-track">
          <div class="toggle-thumb"></div>
        </div>
      </label>
    </header>

    <!-- Sidebar -->
    <aside id="sidebar">
      <div class="brand">My Learning</div>

      <nav>
        <ul>
          <li><a href={href("")}>Tracker</a></li>
          <li><a href={href("goals")}>Goals</a></li>
          <li><a href={href("bucket-list")}>Bucket List</a></li>
        </ul>
      </nav>

      <div class="sidebar-footer">
        <span>¬© 2026</span>
        <!-- Toggle vis√≠vel s√≥ no desktop -->
        <label class="theme-toggle">
          <input type="checkbox" id="theme-toggle-desktop" />
          <div class="toggle-track">
            <div class="toggle-thumb"></div>
          </div>
        </label>
      </div>
    </aside>

    <!-- Main Content -->
    <main>
      <div class="container">
        <article>
          <slot />
        </article>
      </div>
    </main>

    <script>
      // Hamburger menu
      const hamburger = document.getElementById("hamburger");
      const sidebar = document.getElementById("sidebar");

      hamburger.addEventListener("click", () => {
        hamburger.classList.toggle("active");
        sidebar.classList.toggle("open");
      });

      // Fecha menu ao clicar em link (mobile)
      document.querySelectorAll("nav a").forEach(link => {
        link.addEventListener("click", () => {
          if (window.innerWidth <= 768) {
            hamburger.classList.remove("active");
            sidebar.classList.remove("open");
          }
        });
      });

      // Theme toggle (usamos o mesmo checkbox em mobile e desktop)
      const toggleMobile = document.getElementById("theme-toggle");
      const toggleDesktop = document.getElementById("theme-toggle-desktop");
      const html = document.documentElement;

      const savedTheme = localStorage.getItem("theme") || "dark";

      const setTheme = (isLight) => {
        if (isLight) {
          html.classList.add("light");
          localStorage.setItem("theme", "light");
        } else {
          html.classList.remove("light");
          localStorage.setItem("theme", "dark");
        }
        // Sincroniza ambos os checkboxes
        toggleMobile.checked = isLight;
        if (toggleDesktop) toggleDesktop.checked = isLight;
      };

      // Estado inicial
      setTheme(savedTheme === "light");

      // Eventos
      toggleMobile.addEventListener("change", () => setTheme(toggleMobile.checked));
      if (toggleDesktop) {
        toggleDesktop.addEventListener("change", () => setTheme(toggleDesktop.checked));
      }
    </script>
  </body>
</html>